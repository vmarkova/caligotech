{
  "info": {
    "_postman_id": "0c30dd55-f503-46bd-bfbf-0704315a4a63",
    "name": "Drall",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "_postman_id": "e09417d2-6d4d-4990-9a43-789832080cbb",
      "name": "PLAT-109:Verify promo hash is created when promotion is published",
      "description": "",
      "item": [
        {
          "_postman_id": "66557801-0492-43be-9a1c-23242c4b3058",
          "name": "Step 1:Post promotion",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "88868c2f-c7a6-4ab9-8a41-3933715b53d2",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const testObject = pm.response.json();",
                  "//const promo_id = testObject.id;",
                  "",
                  "pm.environment.set(\"promo_id\", testObject.id);",
                  "",
                  "",
                  "/*pm.test(\"Id check\", function () {",
                  "    pm.expect(testObject.id).to.eql(promo_id);",
                  "});*/",
                  "",
                  "pm.test(\"Promo contains Id\", function() {",
                  "    const Id = testObject.id;",
                  "    const lengthId = Id.length > 0;",
                  "    pm.expect(lengthId).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains start date\", function() {",
                  "    const startDate = new Date(testObject.startDate);",
                  "    const isADate = Object.prototype.toString.call(startDate) === '[object Date]';",
                  "    pm.expect(isADate).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains end date\", function() {",
                  "    const endDate = new Date(testObject.endDate);",
                  "    const isADate = Object.prototype.toString.call(endDate) === '[object Date]';",
                  "    pm.expect(isADate).to.eql(true);",
                  "});",
                  "",
                  "/*pm.test(\"Promo contains budgetId\", function() {",
                  "    const budgetId = testObject.budgetId;",
                  "    const lengthbudgetId = budgetId.length > 0;",
                  "    pm.expect(lengthbudgetId).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains familyCode with 3 digits\", function() {",
                  "    const familyCode = testObject.familyCode;",
                  "    const lengthfamilyCode = familyCode.length == 3;",
                  "    pm.expect(lengthfamilyCode).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains gs1Databar with more than 25 digits\", function() {",
                  "    const gs1Databar = testObject.gs1Databar;",
                  "    const lengthgs1Databar = gs1Databar.length > 25;",
                  "    pm.expect(lengthgs1Databar).to.eql(true);",
                  "});",
                  "*/",
                  "pm.test(\"Promo contains title\", function() {",
                  "    const title = testObject.title;",
                  "    const lengthTitle = title.length > 0;",
                  "    pm.expect(lengthTitle).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains text\", function() {",
                  "    const text = testObject.text;",
                  "    const lengthText = text.length > 0;",
                  "    pm.expect(lengthText).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains details\", function() {",
                  "    const details = testObject.details;",
                  "    const lengthDetails = details.length > 0;",
                  "    pm.expect(lengthDetails).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains promo code\", function() {",
                  "    const promoCode = testObject.providerPromotionCode;",
                  "    const lengthPromoCode = promoCode.length > 0;",
                  "    pm.expect(lengthPromoCode).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains images link\", function() {",
                  "    const images = testObject.images;",
                  "    const lengthimages = images.length > 0;",
                  "    pm.expect(lengthimages).to.eql(true);",
                  "});",
                  "",
                  "",
                  "",
                  "var schema = {",
                  "  \"title\" : \"string\",",
                  "  \"providerPromotionCode\" : \"string\",",
                  "  \"text\" : \"string\",",
                  "  \"details\" : \"string\",",
                  "  \"images\" :\"array\",",
                  "  \"rule\" : {",
                  "    \"id\" : null,",
                  "    \"type\" : \"string\",",
                  "    \"condition\" : {",
                  "      \"id\" : null,",
                  "      \"type\" : \"string\",",
                  "      \"mpr\" : 1,",
                  "      \"product\" : {",
                  "        \"upcs\" : \"array\",",
                  "        \"brands\" : [ {",
                  "          \"brand\" : \"string\",",
                  "          \"products\" : [ \"string\" ]",
                  "        } ]",
                  "      }",
                  "    },",
                  "    \"reward\" : {",
                  "      \"type\" : \"string\",",
                  "      \"id\" : null,",
                  "      \"value\" : \"integer\",",
                  "      \"brands\" : [ {",
                  "          \"brand\" : \"string\",",
                  "          \"products\" : \"array\"",
                  "        } ]",
                  "    }",
                  "  },",
                  "  \"startDate\" : \"date\",",
                  "  \"endDate\" : \"date\",",
                  "  \"budgetId\" : \"string\",",
                  "  \"familyCode\" : \"string\",",
                  "  \"gs1Databar\" : \"string\"",
                  "  ",
                  "}",
                  "",
                  "",
                  "pm.test('Schema is valid', function() {",
                  "  pm.expect(tv4.validate(testObject, schema)).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"title\" : \"Get $0.50 on Ivory Body Wash \",\r\n  \"providerPromotionCode\" : \"131240 \",\r\n  \"text\" : \"OFF ONE Ivory Body Wash (21oz or larger) \",\r\n  \"details\" : \"Dealer: Submission to Procter & Gamble signifies compliance with 'Requirements for Proper Coupon Redemption.' Please visit this link for coupon terms for proper redemption: http://www.pg.com/en_US/downloads/partners_suppliers/PG_Coupon_Terms_of_Proper_Redemption.pdf. Limit of one coupon per item. Consumer: Limit ONE coupon per purchase of products and quantities stated. Any other use constitutes fraud. Coupons are not authorized if purchasing products for resale. You may pay sales tax. Not valid in Puerto Rico.\",\r\n  \"images\" : [ \"ivory/5b3e8c36d12f85041119ea07.png\" ],\r\n  \"rule\" : {\r\n    \"id\" : null,\r\n    \"type\" : \"SingleRule\",\r\n    \"condition\" : {\r\n      \"id\" : null,\r\n      \"type\" : \"ClipCondition\"\r\n      }\r\n    },\r\n    \"reward\" : {\r\n      \"type\" : \"DiscountValueReward\",\r\n      \"id\" : null,\r\n      \"value\" : 50,\r\n      \"brands\" : [ {\r\n          \"brand\" : \"1\",\r\n          \"products\" : [ \"12\" ]\r\n        } ]\r\n    }\r\n  },\r\n  \"startDate\" : \"2018-01-01T14:00:00\",\r\n  \"endDate\" : \"2018-01-31T14:00:00\",\r\n  \"budgetId\" : \"budget_id_1\",\r\n  \"familyCode\" : \"130\",\r\n  \"gs1Databar\" : \"81101007560913123933001101303170701\"\r\n  \r\n}"
            },
            "url": "http://qa-apps.caligotech.com:8188/promotions/"
          },
          "response": []
        },
        {
          "_postman_id": "228a7e48-5490-4cb8-b347-37f1409e1556",
          "name": "Step 2:Add Campaign to the Promotion",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "132bc4c7-57d1-4f5e-88aa-34137ee46f9e",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const testObject = pm.response.json();",
                  "pm.environment.set(\"camp_id\", testObject.id);",
                  "const promo_id = pm.environment.get(\"promo_id\");",
                  "",
                  "//const camp_id = testObject.id;",
                  "",
                  "pm.test(\"Promo contains campaign Id\", function() {",
                  "    const id = testObject.id;",
                  "    const lengthid = id.length > 0;",
                  "    pm.expect(lengthid).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains start date\", function() {",
                  "    const startDate = new Date(testObject.startDate);",
                  "    const isADate = Object.prototype.toString.call(startDate) === '[object Date]';",
                  "    pm.expect(isADate).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains end date\", function() {",
                  "    const endDate = new Date(testObject.endDate);",
                  "    const isADate = Object.prototype.toString.call(endDate) === '[object Date]';",
                  "    pm.expect(isADate).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains clipByDate\", function() {",
                  "    const clipByDate = new Date(testObject.clipByDate);",
                  "    const isADate = Object.prototype.toString.call(clipByDate) === '[object Date]';",
                  "    pm.expect(isADate).to.eql(true);",
                  "});",
                  "",
                  "/*pm.test(\"Is clip date before end date in promotion\", function() {",
                  "    const clipByDate = new Date(testObject.clipByDate);",
                  "    const endDate = new Date(testObject.endDate);",
                  "    const clipDateBeforeEnd = clipByDate.getTime() <= endDate.getTime();",
                  "    pm.expect(clipDateBeforeEnd).to.eql(true);",
                  "});*/",
                  "",
                  "pm.test(\"Promotion Id check\", function () {",
                  "    //const equalId = Object.prototype.toString.call(promotionId) === promo_id;",
                  "  //  pm.expect(testObject.promotionId === promo_id).to.eql(true);",
                  " pm.expect(testObject.promotionId).to.eql(promo_id);",
                  " //pm.expect(testObject).to.have.property('id', promo_id);",
                  "});",
                  "",
                  "",
                  "",
                  "pm.test(\"Promo contains modifiedBy\", function() {",
                  "    const modifiedBy = testObject.modifiedBy;",
                  "    const lengthmodifiedBy = modifiedBy.length > 0;",
                  "    pm.expect(lengthmodifiedBy).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains modifiedOn\", function() {",
                  "    const modifiedOnRaw = testObject.modifiedOn;",
                  "    const modifiedOn = new Date(modifiedOnRaw*1000);",
                  "    const isADate =  Object.prototype.toString.call(modifiedOn) === '[object Date]';",
                  "    pm.expect(isADate).to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo contains status\", function() {",
                  "    const status = testObject.status;",
                  "    const lengthstatus = status.length > 0;",
                  "    pm.expect(lengthstatus).to.eql(true);",
                  "});",
                  "",
                  "var schema = {",
                  "  \"clipByDate\": \"date\",",
                  "  \"endDate\": \"date\",",
                  "  \"id\": \"string\",",
                  "  \"modifiedBy\": \"string\",",
                  "  \"modifiedOn\": 0,",
                  "  \"overrides\": {",
                  "    \"details\": \"string\",",
                  "    \"images\": \"array\",",
                  "    \"rule\": {",
                  "      \"id\": 0",
                  "    },",
                  "    \"text\": \"string\",",
                  "    \"title\": \"string\"",
                  "  },",
                  "  \"promotionId\": \"string\",",
                  "  \"retailerProfileId\": \"string\",",
                  "  \"startDate\": \"date\",",
                  "  \"status\": \"string\",",
                  "  \"timezone\": \"string\"",
                  "}",
                  "",
                  "pm.test('Schema is valid', function() {",
                  "  pm.expect(tv4.validate(testObject, schema)).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n \"clipByDate\": \"2019-01-01T14:00:00\",\n \"endDate\": \"2019-01-01T14:00:00\",\n \"overrides\": {\n   \"details\": \"Dealer: Submission to Procter & Gamble signifies compliance with 'Requirements for Proper Coupon Redemption.' Please visit this link for coupon terms for proper redemption: http://www.pg.com/en_US/downloads/partners_suppliers/PG_Coupon_Terms_of_Proper_Redemption.pdf. Limit of one coupon per item. Consumer: Limit ONE coupon per purchase of products and quantities stated. Any other use constitutes fraud. Coupons are not authorized if purchasing products for resale. You may pay sales tax. Not valid in Puerto Rico.\",\n   \"images\": [\n     \"Gain laundry detergent/5b6b6bd4d12f8512623c2e8b.png\"\n   ],\n   \"rule\": {\n     \"id\": 0,\"type\": \"SingleRule\"\n   },\n   \"text\": \"Get $0.50 OFF Gain\",\n   \"title\": \"When buy Two Gain laundry detergent\"\n },\n \"retailerProfileId\": \"3\",\n \"startDate\": \"2019-01-01T14:00:00\"\n   }"
            },
            "url": "http://qa-apps.caligotech.com:8188/promotions/{{promo_id}}/campaigns/"
          },
          "response": []
        },
        {
          "_postman_id": "85f724aa-82d9-4efc-ae6d-1528ec4a61de",
          "name": "Step 3:Publish Promotion",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "70a00987-9b08-418c-a0be-d12311770098",
                "type": "text/javascript",
                "exec": [
                  "",
                  "pm.test(\"Successful POST request\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200,201,202,204]);",
                  "});",
                  "/*",
                  "pm.test(\"Promo is DRAFT or ACTIVE\", function() {",
                  "    pm.expect(testObject.status === \"DRAFT\" || \"ACTIVE\").to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo is not paused\", function() {",
                  "    pm.expect(testObject.status === \"NULL\" || false).to.eql(true);",
                  "});*/"
                ]
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "23bef111-4e63-41e1-acf6-9b2754add19c",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Promo is DRAFT or ACTIVE\", function() {",
                  "    pm.expect(testObject.status === \"DRAFT\" || \"ACTIVE\").to.eql(true);",
                  "});",
                  "",
                  "pm.test(\"Promo is not paused\", function() {",
                  "    pm.expect(testObject.status === \"NULL\" || false).to.eql(true);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "",
                "value": "",
                "disabled": true
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n  \"campaignIds\": [\r\n\t\"{{camp_id}}\"\r\n   ]\r\n}"
            },
            "url": "http://qa-apps.caligotech.com:8188/promotions/{{promo_id}}/publish/",
            "description": "Publish Promotion"
          },
          "response": []
        },
        {
          "_postman_id": "b4d1b617-fb30-4c3b-99f8-b8d5d4cd3400",
          "name": "Step 4: Get promotion from MongoDB",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "9d00a54b-7b5f-43a8-bad1-5712778ed295",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const testObject = pm.response.json();",
                  "const items = testObject.results[0];",
                  "console.log(\"items \"+items);",
                  "let dfs = items.dfsPromotionFileId;",
                  "console.log(\"dfs here \"+dfs);",
                  "pm.environment.set(\"dfsPromotion\", items.dfsPromotionFileId);",
                  "",
                  ""
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "body": {},
            "url": {
              "raw": "http://qa-mongodb.caligotech.com:27080/jedha/promotions/_find?criteria={\"_id\":{\"$oid\":\"{{promo_id}}\"}}",
              "protocol": "http",
              "host": [
                "qa-mongodb",
                "caligotech",
                "com"
              ],
              "port": "27080",
              "path": [
                "jedha",
                "promotions",
                "_find"
              ],
              "query": [
                {
                  "key": "criteria",
                  "value": "{\"_id\":{\"$oid\":\"{{promo_id}}\"}}",
                  "equals": true
                }
              ]
            }
          },
          "response": []
        },
        {
          "_postman_id": "c9c78fc9-0bf9-406e-9524-602dbc49d2a5",
          "name": "Step 5: Get promotion using dfsFileId",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "34b787ef-c0ed-43de-a7fe-90e8f1527f5d",
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json\t"
              },
              {
                "key": "Accept",
                "value": "application/octet-stream"
              }
            ],
            "body": {},
            "url": "http://qa-apps.caligotech.com:8189/dfs/{{dfsPromotion}}"
          },
          "response": []
        }
      ]
    },
    {
      "_postman_id": "8d5badfc-be88-492e-a825-268bc1acf9a3",
      "name": "PLAT-116:Verify system return the same hash when same file is uploaded",
      "description": "",
      "item": []
    },
    {
      "_postman_id": "16c00aaa-654b-404c-ad16-55f03ee1f5c0",
      "name": "Upload a file into dFS as form-data-multipart",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "13c28aa7-6bff-4536-b754-4ec9cc3241fa",
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "const testObject = pm.response.json();",
              "",
              "pm.environment.set(\"hash_id\", testObject.fileId);",
              "",
              ""
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "",
            "value": ""
          },
          {
            "key": "",
            "value": ""
          },
          {
            "key": "",
            "value": "",
            "disabled": true
          }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "Content-Type",
              "value": "application/json",
              "sessionValue": "json",
              "description": "",
              "type": "text"
            },
            {
              "key": "file",
              "value": null,
              "sessionValue": "form-data/multipart",
              "description": "",
              "type": "file"
            },
            {
              "key": "",
              "value": "",
              "sessionValue": null,
              "description": "",
              "type": "text"
            }
          ]
        },
        "url": "http://qa-apps.caligotech.com:8189/dfs"
      },
      "response": []
    },
    {
      "_postman_id": "cf4a4ee5-84bb-4b49-8f5e-f99478d82c5b",
      "name": "Download a file from dFS as binary stream (octet-stream content type)",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "34b787ef-c0ed-43de-a7fe-90e8f1527f5d",
            "type": "text/javascript",
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json\t"
          },
          {
            "key": "Accept",
            "value": "application/octet-stream"
          }
        ],
        "body": {},
        "url": "http://qa-apps.caligotech.com:8189/dfs/{{dfsPromotion}}"
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "id": "44f3a4a0-badc-4b58-a848-326f35051504",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "id": "212983f0-5f25-46be-b769-6413f9897110",
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "id": "d8cd1b3f-5290-4e6c-9dd1-fcf6c019cb79",
      "key": "hash_id",
      "value": "",
      "type": "string",
      "description": ""
    }
  ]
}